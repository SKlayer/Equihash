multi-thread version 
simulate ok
